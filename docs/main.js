!function(r){function t(t){for(var e,n,o=t[0],i=t[1],s=t[2],a=0,h=[];a<o.length;a++)n=o[a],l[n]&&h.push(l[n][0]),l[n]=0;for(e in i)Object.prototype.hasOwnProperty.call(i,e)&&(r[e]=i[e]);for(f&&f(t);h.length;)h.shift()();return u.push.apply(u,s||[]),c()}function c(){for(var t,e=0;e<u.length;e++){for(var n=u[e],o=!0,i=1;i<n.length;i++){var s=n[i];0!==l[s]&&(o=!1)}o&&(u.splice(e--,1),t=a(a.s=n[0]))}return t}var n={},l={1:0},u=[];function a(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return r[t].call(e.exports,e,e.exports,a),e.l=!0,e.exports}a.m=r,a.c=n,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(n,o,function(t){return e[t]}.bind(null,o));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="";var e=window.webpackJsonp=window.webpackJsonp||[],o=e.push.bind(e);e.push=t,e=e.slice();for(var i=0;i<e.length;i++)t(e[i]);var f=o;u.push([8,0]),c()}({29:function(t,e,n){"use strict";n.r(e);n(9);var o,i,s,a,h=n(7),r=n.n(h),c=function(){function o(t){var e=this;if(this.noteWidth=102,this.noteHeight=102,this.noteWidthFlip=125,this.scale=3,this.saveSpeed=12,this._notePng="",this.tapCanvas=document.createElement("canvas"),this.longLoopCanvas=document.createElement("canvas"),this.longMoveCanvas=document.createElement("canvas"),this.longMoveWhiteCanvas=document.createElement("canvas"),this.flipLeftCanvas=document.createElement("canvas"),this.flipRightCanvas=document.createElement("canvas"),this._se=null,this._seOk=null,o._instance)return o._instance;this.noteWidth=t.noteWidth||this.noteWidth,this.noteHeight=t.noteHeight||this.noteHeight,this.noteWidthFlip=t.noteWidthFlip||this.noteWidthFlip,this.scale=t.scale||this.scale,this.saveSpeed=t.saveSpeed||this.saveSpeed,this._notePng=t.notePng,this.tapCanvas.width=this.longLoopCanvas.width=this.longMoveCanvas.width=this.longMoveWhiteCanvas.width=this.tapCanvas.height=this.longLoopCanvas.height=this.longMoveCanvas.height=this.longMoveWhiteCanvas.height=this.flipLeftCanvas.height=this.flipRightCanvas.height=this.noteWidth,this.flipLeftCanvas.width=this.flipRightCanvas.width=this.noteWidthFlip;var n=o.newImage(this._notePng);return n.addEventListener("load",function(){e.tapCanvas.getContext("2d").drawImage(n,0,0,e.noteWidth,e.noteHeight,0,0,e.noteWidth,e.noteHeight),e.longLoopCanvas.getContext("2d").drawImage(n,e.noteWidth,0,e.noteWidth,e.noteHeight,0,0,e.noteWidth,e.noteHeight),e.longMoveCanvas.getContext("2d").drawImage(n,2*e.noteWidth,0,e.noteWidth,e.noteHeight,0,0,e.noteWidth,e.noteHeight),e.longMoveWhiteCanvas.getContext("2d").drawImage(n,3*e.noteWidth,0,e.noteWidth,e.noteHeight,0,0,e.noteWidth,e.noteHeight),e.flipLeftCanvas.getContext("2d").drawImage(n,4*e.noteWidth,0,e.noteWidthFlip,e.noteHeight,0,0,e.noteWidthFlip,e.noteHeight),e.flipRightCanvas.getContext("2d").drawImage(n,4*e.noteWidth+e.noteWidthFlip,0,e.noteWidthFlip,e.noteHeight,0,0,e.noteWidthFlip,e.noteHeight)}),t.se&&(this._se=o.createAudio(t.se)),t.seOk&&(this._seOk=o.createAudio(t.seOk)),o._instance=this}return o.newImage=function(t){var e=new Image;return e.src=t,e},o.createAudio=function(t){var e=new Audio(t);return e.preload="auto",e},Object.defineProperty(o.prototype,"noteWidthDelta",{get:function(){return this.noteWidthFlip-this.noteWidth},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"noteWidthHalf",{get:function(){return this.noteWidth/2},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"noteHeightHalf",{get:function(){return this.noteHeight/2},enumerable:!0,configurable:!0}),o.prototype.getInstance=function(){if(!o._instance)throw new Error("Global instance null.");return o._instance},o.prototype.playSe=function(){this._se&&(this._se.currentTime=0,this._se.play().catch(function(t){return console.log(t)}))},o.prototype.playSeOk=function(){this._seOk&&(this._seOk.currentTime=0,this._seOk.play().catch(function(t){return console.log(t)}))},o._instance=null,o}(),l=new c({notePng:"./img/icon_notes.png"}),u=c,f=function(){function t(t){this._connectionHeight=12,this._sec=t.sec,this._x=O.X[t.finishPos-1],this._y=-l.noteHeight,this._connection=null,this._synchronizedNote=null}return t.prototype.setY=function(t){this._y=t},t.prototype.getX=function(){return this._x},t.prototype.setX=function(t){this._x=t},t.prototype.saveDrawSync=function(t){if(this._synchronizedNote){var e=O.X[this._synchronizedNote.finishPos-1]+l.noteWidthHalf,n=O.saveCalY(t,this._sec)+l.noteHeightHalf-this._connectionHeight/2/l.scale,o=this._x+l.noteWidthHalf+(O.X.includes(this._x)?0:l.noteWidthDelta);t.saveCtx.fillRect((o<e?o:e)+l.noteWidthHalf,n,(o<e?e-o:o-e)-l.noteWidth,this._connectionHeight/l.scale)}},t.prototype.drawSync=function(t){if(this._synchronizedNote){var e=O.X[this._synchronizedNote.finishPos-1]+l.noteWidthHalf,n=O.calY(t.options.speed,this._sec,t.audio.currentTime)+l.noteHeightHalf-this._connectionHeight/2,o=this._x+l.noteWidthHalf+(O.X.includes(this._x)?0:l.noteWidthDelta);t.frontCtx.fillRect((o<e?o:e)+l.noteWidthHalf,n,(o<e?e-o:o-e)-l.noteWidth,this._connectionHeight)}},t.prototype.isNeedDraw=function(){return this._y<-l.noteHeight?!!this._connection&&this._connection._instance._y>=-l.noteHeight:this._y<O.TOP_TO_TARGET_POSITION},t}(),_=(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),p=function(o){function t(t,e){var n=o.call(this,t)||this;return e&&(n._synchronizedNote=e),n}return _(t,o),t.prototype.drawConnection=function(t){},t.prototype.drawNote=function(t){t.frontCtx.drawImage(l.tapCanvas,this._x,this._y)},t.prototype.saveDrawConnection=function(t){},t.prototype.saveDrawNote=function(t){t.saveCtx.drawImage(l.tapCanvas,0,0,l.tapCanvas.width,l.tapCanvas.height,this._x,this._y,l.tapCanvas.width/l.scale,l.tapCanvas.height/l.scale)},t}(f),g=(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),d=function(i){function t(t,e,n){var o=i.call(this,t)||this;return o._status=t.status,1===o._status&&(o._x=o._x-l.noteWidthDelta),e&&(o._connection=e),n&&(o._synchronizedNote=n),o}return g(t,i),t.prototype._drawFlipConnection=function(t,e,n){if(!(n>=O.TOP_TO_TARGET_POSITION)){var o=1===this._status?this._x+l.noteWidthDelta+l.noteWidthHalf:this._x+l.noteWidthHalf;t.beginPath(),t.moveTo(o,this._y),t.lineTo(o,this._y+l.noteHeight),t.lineTo(e+l.noteWidthHalf,n+l.noteHeight),t.lineTo(e+l.noteWidthHalf,n),t.lineTo(o,this._y),t.fill()}},t.prototype._drawLongConnection=function(t,e){var n=1===this._status?this._x+l.noteWidthDelta:this._x;t.beginPath(),t.arc(n+l.noteWidthHalf,this._y+l.noteHeightHalf,l.noteWidthHalf,0,Math.PI,!0);var o=e>O.TOP_TO_TARGET_POSITION?O.TOP_TO_TARGET_POSITION+l.noteHeightHalf:e+l.noteHeightHalf;t.lineTo(n,o),t.arc(n+l.noteWidthHalf,o,l.noteWidthHalf,Math.PI,2*Math.PI,!0),t.lineTo(n+l.noteWidth,this._y+l.noteHeightHalf),t.fill()},t.prototype._drawMoveConnection=function(t,e,n,o){t.beginPath(),t.arc(1===this._status?this._x+l.noteWidthHalf+l.noteWidthDelta:this._x+l.noteWidthHalf,this._y+l.noteHeightHalf,l.noteWidthHalf,0,Math.PI,!0);var i=n>O.TOP_TO_TARGET_POSITION?O.TOP_TO_TARGET_POSITION+l.noteHeightHalf:n+l.noteHeightHalf,s=n>O.TOP_TO_TARGET_POSITION?e+(this._x-e)*-(O.TOP_TO_TARGET_POSITION-n)/(-(O.TOP_TO_TARGET_POSITION-n)+(O.TOP_TO_TARGET_POSITION-this._y)):e;t.lineTo(s,i),t.arc(s+l.noteWidthHalf,i,l.noteWidthHalf,Math.PI,2*Math.PI,!0),t.lineTo(1===this._status?this._x+l.noteWidth+l.noteWidthDelta:this._x+l.noteWidth,this._y+l.noteHeightHalf),t.fill(),n>O.TOP_TO_TARGET_POSITION&&(o?t.drawImage(l.longMoveWhiteCanvas,0,0,l.longMoveWhiteCanvas.width,l.longMoveWhiteCanvas.height,s,i-l.noteHeightHalf,l.longMoveWhiteCanvas.width/o,l.longMoveWhiteCanvas.height/o):t.drawImage(l.longMoveWhiteCanvas,s,i-l.noteHeightHalf))},t.prototype.drawConnection=function(t){if(this._connection){var e=O.X[this._connection.finishPos-1],n=O.calY(t.options.speed,this._connection.sec,t.audio.currentTime);1===this._connection.type?this._drawFlipConnection(t.frontCtx,e,n):2===this._connection.type?0===this._connection.status?this._drawLongConnection(t.frontCtx,n):this._drawFlipConnection(t.frontCtx,e,n):3===this._connection.type&&(0===this._connection.status?this._drawMoveConnection(t.frontCtx,e,n):this._drawFlipConnection(t.frontCtx,e,n))}},t.prototype.drawNote=function(t){t.frontCtx.drawImage(1===this._status?l.flipLeftCanvas:l.flipRightCanvas,this._x,this._y)},t.prototype.saveDrawConnection=function(t){if(this._connection){var e=O.X[this._connection.finishPos-1],n=O.saveCalY(t,this._connection.sec);1===this._connection.type?this._drawFlipConnection(t.saveCtx,e,n):2===this._connection.type?0===this._connection.status?this._drawLongConnection(t.saveCtx,n):this._drawFlipConnection(t.saveCtx,e,n):3===this._connection.type&&(0===this._connection.status?this._drawMoveConnection(t.saveCtx,e,n,l.scale):this._drawFlipConnection(t.saveCtx,e,n))}},t.prototype.saveDrawNote=function(t){1===this._status?t.saveCtx.drawImage(l.flipLeftCanvas,0,0,l.flipLeftCanvas.width,l.flipLeftCanvas.height,this._x,this._y,l.flipLeftCanvas.width/l.scale,l.flipLeftCanvas.height/l.scale):t.saveCtx.drawImage(l.flipRightCanvas,0,0,l.flipRightCanvas.width,l.flipRightCanvas.height,this._x,this._y,l.flipRightCanvas.width/l.scale,l.flipRightCanvas.height/l.scale)},t}(f),v=(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),y=function(i){function t(t,e,n){var o=i.call(this,t)||this;return e&&(o._connection=e),n&&(o._synchronizedNote=n),o}return v(t,i),t.prototype.drawConnection=function(t){if(this._connection){var e=O.calY(t.options.speed,this._connection.sec,t.audio.currentTime);t.frontCtx.beginPath(),t.frontCtx.arc(this._x+l.noteWidthHalf,this._y+l.noteHeightHalf,l.noteWidthHalf,0,Math.PI,!0);var n=e>O.TOP_TO_TARGET_POSITION?O.TOP_TO_TARGET_POSITION+l.noteHeightHalf:e+l.noteHeightHalf;t.frontCtx.lineTo(this._x,n),t.frontCtx.arc(this._x+l.noteWidthHalf,n,l.noteWidthHalf,Math.PI,2*Math.PI,!0),t.frontCtx.lineTo(this._x+l.noteWidth,this._y+l.noteHeightHalf),t.frontCtx.fill()}},t.prototype.drawNote=function(t){t.frontCtx.drawImage(l.longLoopCanvas,this._x,this._y)},t.prototype.saveDrawConnection=function(t){if(this._connection){var e=O.saveCalY(t,this._connection.sec);t.saveCtx.beginPath(),t.saveCtx.arc(this._x+l.noteWidthHalf,this._y+l.noteHeightHalf,l.noteWidthHalf,0,Math.PI,!0);var n=e>O.TOP_TO_TARGET_POSITION?O.TOP_TO_TARGET_POSITION+l.noteHeightHalf:e+l.noteHeightHalf;t.saveCtx.lineTo(this._x,n),t.saveCtx.arc(this._x+l.noteWidthHalf,n,l.noteWidthHalf,Math.PI,2*Math.PI,!0),t.saveCtx.lineTo(this._x+l.noteWidth,this._y+l.noteHeightHalf),t.saveCtx.fill()}},t.prototype.saveDrawNote=function(t){t.saveCtx.drawImage(l.longLoopCanvas,0,0,l.longLoopCanvas.width,l.longLoopCanvas.height,this._x,this._y,l.longLoopCanvas.width/l.scale,l.longLoopCanvas.height/l.scale)},t}(f),T=(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),C=function(i){function t(t,e,n){var o=i.call(this,t)||this;return e&&(o._connection=e),n&&(o._synchronizedNote=n),o}return T(t,i),t.prototype.drawConnection=function(t){if(this._connection){var e=O.X[this._connection.finishPos-1],n=O.calY(t.options.speed,this._connection.sec,t.audio.currentTime);t.frontCtx.beginPath(),t.frontCtx.arc(this._x+l.noteWidthHalf,this._y+l.noteHeightHalf,l.noteWidthHalf,0,Math.PI,!0);var o=n>O.TOP_TO_TARGET_POSITION?O.TOP_TO_TARGET_POSITION+l.noteHeightHalf:n+l.noteHeightHalf,i=n>O.TOP_TO_TARGET_POSITION?e+(this._x-e)*-(O.TOP_TO_TARGET_POSITION-n)/(-(O.TOP_TO_TARGET_POSITION-n)+(O.TOP_TO_TARGET_POSITION-this._y)):e;t.frontCtx.lineTo(i,o),t.frontCtx.arc(i+l.noteWidthHalf,o,l.noteWidthHalf,Math.PI,2*Math.PI,!0),t.frontCtx.lineTo(this._x+l.noteWidth,this._y+l.noteHeightHalf),t.frontCtx.fill(),n>O.TOP_TO_TARGET_POSITION&&t.frontCtx.drawImage(l.longMoveWhiteCanvas,i,o-l.noteHeightHalf)}},t.prototype.drawNote=function(t){t.frontCtx.drawImage(l.longMoveCanvas,this._x,this._y)},t.prototype.saveDrawConnection=function(t){if(this._connection){var e=O.X[this._connection.finishPos-1],n=O.saveCalY(t,this._connection.sec);t.saveCtx.beginPath(),t.saveCtx.arc(this._x+l.noteWidthHalf,this._y+l.noteHeightHalf,l.noteWidthHalf,0,Math.PI,!0);var o=n>O.TOP_TO_TARGET_POSITION?O.TOP_TO_TARGET_POSITION+l.noteHeightHalf:n+l.noteHeightHalf,i=n>O.TOP_TO_TARGET_POSITION?e+(this._x-e)*-(O.TOP_TO_TARGET_POSITION-n)/(-(O.TOP_TO_TARGET_POSITION-n)+(O.TOP_TO_TARGET_POSITION-this._y)):e;t.saveCtx.lineTo(i,o),t.saveCtx.arc(i+l.noteWidthHalf,o,l.noteWidthHalf,Math.PI,2*Math.PI,!0),t.saveCtx.lineTo(this._x+l.noteWidth,this._y+l.noteHeightHalf),t.saveCtx.fill(),n>O.TOP_TO_TARGET_POSITION&&t.saveCtx.drawImage(l.longMoveWhiteCanvas,0,0,l.longMoveWhiteCanvas.width,l.longMoveWhiteCanvas.height,i,o-l.noteHeightHalf,l.longMoveWhiteCanvas.width/l.scale,l.longMoveWhiteCanvas.height/l.scale)}},t.prototype.saveDrawNote=function(t){t.saveCtx.drawImage(l.longMoveCanvas,0,0,l.longMoveCanvas.width,l.longMoveCanvas.height,this._x,this._y,l.longMoveCanvas.width/l.scale,l.longMoveCanvas.height/l.scale)},t}(f),O=function(){function c(t,e,n){return this.options={speed:12},this._isReady=!1,this._isReadyToSave=!1,this._isPaused=!0,this._isClean=!0,c._instance?c._instance:(n&&(this.options=Object.assign({},this.options,n)),this.audio=u.createAudio(t.src),this.song=t,this._resolveNoteList(),this._resolveDOM(e),c._instance=this)}return c.main=function(t){var e=document.getElementById("bg");window.addEventListener("resize",function(){var t=window.innerWidth/window.innerHeight>=1280/824;e.className=t?"img-middle":"img-center"},!1),t&&c.init(t,document.body)},c.init=function(t,e,n){return new c(t,e,n)},c.calY=function(t,e,n){return c.TOP_TO_TARGET_POSITION-~~(60*t*(e-n))},c.saveCalY=function(t,e){return t.saveCanvas.height-~~(60*l.saveSpeed*e)/l.scale},c.prototype._setNoteInstance=function(t,e){this.song.score[t]._instance||(this.song.score[t]._instance=e)},c.prototype._resolveNoteList=function(){for(var t=0;t<this.song.score.length;t++)if(!this.song.score[t]._instance){var e=this.song.score[t];switch(e.type){case 1:if(0===e.status)this._setNoteInstance(t,new p(e,this._getSyncNote(t)));else{var n=this._findSameGroup(t,e.groupId);if(n.length){for(var o=0;o<n.length-1;o++)if(this.song.score[n[o]].finishPos===this.song.score[n[o+1]].finishPos){n=n.slice(0,o+1);break}for(var i=n.length-1;0<i;i--)this._setNoteInstance(n[i],new d(this.song.score[n[i]],this.song.score[n[i-1]],this._getSyncNote(n[i])));this._setNoteInstance(n[0],new d(this.song.score[n[0]],e,this._getSyncNote(n[0])))}this._setNoteInstance(t,new d(e,void 0,this._getSyncNote(t)))}break;case 2:var s=this._findLongNote(t,e.finishPos);if(-1!==s){var a=this._findSameGroup(s,this.song.score[s].groupId);if(a.length){for(i=a.length-1;0<i;i--)2===this.song.score[a[i]].type&&0===this.song.score[a[i]].status?this._setNoteInstance(a[i],new y(this.song.score[a[i]],this.song.score[a[i-1]],this._getSyncNote(a[i]))):this._setNoteInstance(a[i],new d(this.song.score[a[i]],this.song.score[a[i-1]],this._getSyncNote(a[i])));2===this.song.score[a[0]].type&&0===this.song.score[a[0]].status?this._setNoteInstance(a[0],new y(this.song.score[a[0]],this.song.score[s],this._getSyncNote(a[0]))):this._setNoteInstance(a[0],new d(this.song.score[a[0]],this.song.score[s],this._getSyncNote(a[0])))}2===this.song.score[s].type&&0===this.song.score[s].status?this._setNoteInstance(s,new y(this.song.score[s],e,this._getSyncNote(s))):this._setNoteInstance(s,new d(this.song.score[s],e,this._getSyncNote(s)))}this._setNoteInstance(t,new y(e,void 0,this._getSyncNote(t)));break;case 3:var h=this._findSameGroup(t,e.groupId);if(h.length){for(i=h.length-1;0<i;i--)3===this.song.score[h[i]].type&&0===this.song.score[h[i]].status?this._setNoteInstance(h[i],new C(this.song.score[h[i]],this.song.score[h[i-1]],this._getSyncNote(h[i]))):this._setNoteInstance(h[i],new d(this.song.score[h[i]],this.song.score[h[i-1]],this._getSyncNote(h[i])));3===this.song.score[h[0]].type&&0===this.song.score[h[0]].status?this._setNoteInstance(h[0],new C(this.song.score[h[0]],e,this._getSyncNote(h[0]))):this._setNoteInstance(h[0],new d(this.song.score[h[0]],e,this._getSyncNote(h[0])))}this._setNoteInstance(t,new C(e,void 0,this._getSyncNote(t)))}}},c.prototype.start=function(){var t=this;if(this._isReady){this.audio.play().catch(function(t){return console.log(t)});var e=this;!function t(){e._cal();e._renderNote();e._t=window.requestAnimationFrame(t)}()}else setTimeout(function(){t.start()},100)},c.prototype.stop=function(){this.audio.pause(),window.cancelAnimationFrame(this._t)},c.prototype._clear=function(){this._isClean||(this.frontCtx.clearRect(0,0,c.CANVAS_WIDTH,c.CANVAS_HEIGHT-15),this._isClean=!0)},c.prototype._cal=function(){for(var t=-1,e=0;e<this.song.score.length;e++){if(this.song.score[e].sec>this.audio.currentTime){t=e;break}this.song.score[e]._instance.setY(c.calY(this.options.speed,this.song.score[e].sec,this.audio.currentTime))}-1===t&&(t=this.song.score.length),this._comboDom.innerHTML!==""+t&&(this._comboDom.innerHTML=""+t);for(e=t;e<this.song.score.length;e++)this.song.score[e]._instance.setY(c.calY(this.options.speed,this.song.score[e].sec,this.audio.currentTime))},c.prototype._findLongNote=function(t,e){for(var n=t+1;n<this.song.score.length;n++)if(this.song.score[n].finishPos===e)return n;return-1},c.prototype._findSameGroup=function(t,e){if(0===e)return[];for(var n=[],o=t+1;o<this.song.score.length;o++)this.song.score[o].groupId===e&&n.push(o);return n},c.prototype._renderNote=function(){this._clear();for(var t=this.song.score.length-1;0<=t;t--)this.song.score[t]._instance.isNeedDraw()&&this.song.score[t]._instance.drawConnection(this);this.frontCtx.save(),this.frontCtx.fillStyle="#fff";for(t=this.song.score.length-1;0<=t;t--)this.song.score[t]._instance.isNeedDraw()&&this.song.score[t]._instance.drawSync(this);this.frontCtx.restore();for(t=this.song.score.length-1;0<=t;t--)this.song.score[t]._instance.isNeedDraw()&&this.song.score[t]._instance.drawNote(this);this._isClean=!1},c.prototype._getSyncNote=function(t){if(t!==this.song.score.length-1&&1===this.song.score[t].sync&&this.song.score[t].sec===this.song.score[t+1].sec)return this.song.score[t+1]},c.prototype._saveScore=function(){var h=this;if(this._isReady){var r=function(){if(!h._isReadyToSave){h.stop(),h.saveCanvas.height=60*l.saveSpeed*h.audio.duration/l.scale,h.saveCtx=h.saveCanvas.getContext("2d"),h.saveCtx.fillStyle="rgba(255, 255, 255, 0.66)",h.saveCtx.save(),h.saveCtx.fillStyle="rgb(39, 40, 34)",h.saveCtx.font="12px Consolas",h.saveCtx.fillRect(0,0,h.saveCanvas.width,h.saveCanvas.height),h.saveCtx.strokeStyle="#e070d0",h.saveCtx.fillStyle="#e070d0";var t=h.saveCanvas.height-10;h.saveCtx.font="13px -apple-system, BlinkMacSystemFont, Segoe WPC,Segoe UI, HelveticaNeue-Light, Noto Sans, Microsoft YaHei, PingFang SC, Hiragino Sans GB, Source Han Sans SC, Source Han Sans CN, Source Han Sans, sans-serif",h.saveCtx.fillStyle="#fff",h.saveCtx.textAlign="center",h.saveCtx.fillText("https://github.com/toyobayashi/mishiro-score-viewer",h.saveCanvas.width/2,t-7),h.saveCtx.restore(),l.noteWidth/=l.scale,l.noteHeight/=l.scale,l.noteWidthFlip/=l.scale;var e=c.TOP_TO_TARGET_POSITION,n=c.X;c.X=[32,208,383,558,731].map(function(t){return t/l.scale}),c.TOP_TO_TARGET_POSITION=h.saveCanvas.height;for(var o=0;o<h.song.score.length;o++)h.song.score[o]._instance.setX(h.song.score[o]._instance.getX()/l.scale),h.song.score[o]._instance.setY(c.saveCalY(h,h.song.score[o].sec));for(o=h.song.score.length-1;0<=o;o--)h.song.score[o]._instance.saveDrawConnection(h);h.saveCtx.save(),h.saveCtx.fillStyle="#fff";for(o=h.song.score.length-1;0<=o;o--)h.song.score[o]._instance.saveDrawSync(h);h.saveCtx.restore();for(o=h.song.score.length-1;0<=o;o--)h.song.score[o]._instance.saveDrawNote(h);for(o=0;o<h.song.score.length;o++)h.song.score[o]._instance.setX(h.song.score[o]._instance.getX()*l.scale);l.noteWidth*=l.scale,l.noteHeight*=l.scale,l.noteWidthFlip*=l.scale,c.TOP_TO_TARGET_POSITION=e,c.X=n}var i=h.saveCanvas.toDataURL("image/png");if("data:,"===i){var s=l.saveSpeed;return l.saveSpeed--,r(),void(l.saveSpeed=s)}h._isReadyToSave=!0,h.start();var a=document.createElement("a");a.href=i.replace("image/png","image/octet-stream"),a.download="score.png",a.click()};r()}else setTimeout(function(){h._saveScore()},100)},c.prototype._resolveDOM=function(t){var e=this;this.frontCanvas=document.createElement("canvas"),this.backCanvas=document.createElement("canvas"),this.saveCanvas=document.createElement("canvas"),this.frontCanvas.width=this.backCanvas.width=c.CANVAS_WIDTH,this.frontCanvas.height=this.backCanvas.height=c.CANVAS_HEIGHT,this.saveCanvas.width=c.CANVAS_WIDTH/l.scale,this.frontCanvas.className=this.backCanvas.className="canvas canvas-center",this.pauseButton=document.createElement("button"),this.pauseButton.innerHTML="play",this.pauseButton.addEventListener("click",function(){l.playSe(),e._isPaused?e.start():e.stop()}),this.pauseButton.className="cgss-btn cgss-btn-ok",this.pauseButton.style.position="absolute",this.pauseButton.style.zIndex="2000",this.pauseButton.style.top="2%",this.pauseButton.style.left="1%",this.saveButton=document.createElement("button"),this.saveButton.innerHTML="save",this.saveButton.addEventListener("click",function(){l.playSeOk(),e._saveScore()}),this.saveButton.className="cgss-btn cgss-btn-ok",this.saveButton.style.position="absolute",this.saveButton.style.zIndex="2000",this.saveButton.style.top="calc(2% + 84px)",this.saveButton.style.left="1%",this.rangeInput=document.createElement("input"),this.rangeInput.type="range",this.rangeInput.min="0",this.rangeInput.max="100",this.rangeInput.value="0",this.rangeInput.style.position="absolute",this.rangeInput.style.zIndex="2000",this.rangeInput.style.width="50%",this.rangeInput.style.left="25%",this.rangeInput.style.bottom="10px",this.rangeInput.addEventListener("input",function(t){e.audio.currentTime=Number(t.target.value)}),this.speedInput=document.createElement("input"),this.speedInput.type="range",this.speedInput.min="5",this.speedInput.max="20",this.speedInput.value="12",this.speedInput.style.position="absolute",this.speedInput.style.zIndex="2000",this.speedInput.style.width="15%",this.speedInput.style.left="2%",this.speedInput.style.bottom="10px",this.speedInput.addEventListener("input",function(t){e.options.speed=Number(t.target.value)}),t.appendChild(this.backCanvas),t.appendChild(this.frontCanvas),t.appendChild(this.pauseButton),t.appendChild(this.saveButton),t.appendChild(this.rangeInput),t.appendChild(this.speedInput),this._comboDom=document.getElementById("combo"),this.frontCtx=this.frontCanvas.getContext("2d"),this.backCtx=this.backCanvas.getContext("2d"),this.frontCtx.fillStyle="rgba(255, 255, 255, 0.66)";var n=u.newImage("./img/live_icon_857x114.png");n.addEventListener("load",function(){e.backCtx.drawImage(n,5,c.CANVAS_HEIGHT-c.BOTTOM-114)},!1),this.audio.addEventListener("canplay",function(){e._isReady=!0,e.rangeInput.max=e.audio.duration.toString()}),this.audio.addEventListener("play",function(){e._isPaused=!1,e.pauseButton.innerHTML="pause",e.pauseButton.className="cgss-btn cgss-btn-star"}),this.audio.addEventListener("pause",function(){e._isPaused=!0,e.pauseButton.innerHTML="play",e.pauseButton.className="cgss-btn cgss-btn-ok"}),this.audio.addEventListener("ended",function(){window.close()},!1),this.audio.addEventListener("timeupdate",function(){e.rangeInput.value=e.audio.currentTime.toString(),e.rangeInput.style.backgroundSize=e.audio.currentTime/e.audio.duration*100+"% 100%"})},c._instance=null,c.CANVAS_WIDTH=867,c.CANVAS_HEIGHT=720,c.X=[32,208,383,558,731],c.TOP_TO_TARGET_POSITION=c.CANVAS_HEIGHT-(c.BOTTOM=20)-114+6,c}(),I=function(s,a,h,r){return new(h||(h=Promise))(function(t,e){function n(t){try{i(r.next(t))}catch(t){e(t)}}function o(t){try{i(r.throw(t))}catch(t){e(t)}}function i(e){e.done?t(e.value):new h(function(t){t(e.value)}).then(n,o)}i((r=r.apply(s,a||[])).next())})},w=function(n,o){var i,s,a,t,h={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;h;)try{if(i=1,s&&(a=2&e[0]?s.return:e[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,e[1])).done)return a;switch(s=0,a&&(e=[2&e[0],a.value]),e[0]){case 0:case 1:a=e;break;case 4:return h.label++,{value:e[1],done:!1};case 5:h.label++,s=e[1],e=[0];continue;case 7:e=h.ops.pop(),h.trys.pop();continue;default:if(!(a=0<(a=h.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){h=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){h.label=e[1];break}if(6===e[0]&&h.label<a[1]){h.label=a[1],a=e;break}if(a&&h.label<a[2]){h.label=a[2],h.ops.push(e);break}a[2]&&h.ops.pop(),h.trys.pop();continue}e=o.call(n,h)}catch(t){e=[6,t],s=0}finally{i=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}};!function(){I(this,void 0,void 0,function(){var e,n,o,i;return w(this,function(t){switch(t.label){case 0:return[4,r.a.get("./res/score.csv")];case 1:return e=t.sent().data,n=function(t){for(var e=t.split("\n"),n=e[1].split(",").map(function(t){return Number(t)})[5],o=[],i=2;i<e.length;i++){var s=e[i].split(",").map(function(t){return Number(t)});1!==s[2]&&2!==s[2]&&3!==s[2]||o.push({sec:s[1],type:s[2],finishPos:s[4],status:s[5],sync:s[6],groupId:s[7]})}return{fullCombo:n,score:o}}(e),o=n.fullCombo,i=n.score,O.main({src:"./res/live.mp3",fullCombo:o,score:i}),[2]}})})}()},8:function(t,e,n){t.exports=n(29)},9:function(t,e,n){}});